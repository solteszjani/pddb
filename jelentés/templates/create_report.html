<!-- create_report.html -->
<form method="POST" id="reportForm">
    <textarea name="content" id="reportContent" rows="10"></textarea>
    <button type="submit">Mentés</button>
</form>

<!-- Sablonok gomb -->
<button id="templatesBtn">Sablonok</button>

<!-- Sablonok modal -->
<div id="templatesModal" style="display:none;">
    <h3>Sablonok</h3>
    <ul id="templatesList">
        {% for t in templates %}
            <li data-id="{{ t.id }}">
                {{ t.name }}
                {% if t.user_id %}
                    <button class="deleteTemplate">Törlés</button>
                {% endif %}
                <button class="useTemplate">Használ</button>
            </li>
        {% endfor %}
    </ul>
    <h4>Új sablon mentése</h4>
    <input type="text" id="newTemplateName" placeholder="Sablon neve">
    <button id="saveTemplateBtn">Mentés</button>
    <button id="closeModal">Bezár</button>
</div>

<script>
document.getElementById('templatesBtn').onclick = () => {
    document.getElementById('templatesModal').style.display = 'block';
};

document.getElementById('closeModal').onclick = () => {
    document.getElementById('templatesModal').style.display = 'none';
};

// Használ sablon
document.querySelectorAll('.useTemplate').forEach(btn => {
    btn.onclick = (e) => {
        const li = e.target.closest('li');
        const templateContent = li.getAttribute('data-content'); // opcionális: ha elmentjük
        document.getElementById('reportContent').value += templateContent + "\n";
    }
});

// Új sablon mentése
document.getElementById('saveTemplateBtn').onclick = () => {
    const name = document.getElementById('newTemplateName').value;
    const content = document.getElementById('reportContent').value;
    fetch('/save_template', {
        method: 'POST',
        headers: {'Content-Type':'application/x-www-form-urlencoded'},
        body: `name=${encodeURIComponent(name)}&content=${encodeURIComponent(content)}`
    }).then(res => res.json()).then(data => {
        if(data.success) location.reload();
    });
};

// Sablon törlése
document.querySelectorAll('.deleteTemplate').forEach(btn => {
    btn.onclick = (e) => {
        const id = e.target.closest('li').getAttribute('data-id');
        fetch('/delete_template', {
            method: 'POST',
            headers: {'Content-Type':'application/x-www-form-urlencoded'},
            body: `id=${id}`
        }).then(res => res.json()).then(data => {
            if(data.success) location.reload();
        });
    }
});
</script>
